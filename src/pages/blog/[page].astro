---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostCard from "../../components/ui/PostCard.astro";
import Pagination from "../../components/ui/Pagination.astro";

export async function getStaticPaths({ paginate }: { paginate: any }) {
  const allPosts = await getCollection("blogs");
  allPosts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

  return paginate(allPosts, { pageSize: 8 });
}

const { page }: { page: any } = Astro.props;
---

<BaseLayout
  title="Posts"
  description="All posts of Luna"
  image="./favicon.png"
  url="https://lunakit.netlify.app/posts"
>
  <main class="body-margin">
    <h1 class="heading">Blog</h1>
    <ul class="space-y-3">
      {
        page.data.map((post: any) => (
          <li>
            <PostCard
              title={post.data.title}
              date={post.data.date
                .toLocaleDateString("en-GB", {
                  day: "numeric",
                  month: "short",
                })
                .slice(0, 11)}
              url={`/blog/${post.id}`}
              tags={post.data.tags}
            />
          </li>
        ))
      }
    </ul>
    <Pagination page={page} />
  </main>
</BaseLayout>
